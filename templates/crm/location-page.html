{% extends 'base/base.html' %}
{% load static %}
{% block title %}{{ record.get_full_name }}{% endblock title %}
{% block style %}
    <style>
    </style>
{% endblock style %}
{% block content %}
    {% load crm_tags %}

    <div class="card">

        <div class="card-header d-flex justify-content-between">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/location"><i
                            class="ri-home-4-line mr-1 float-left"></i>Lokalizacje</a></li>
                    <li class="breadcrumb-item active"
                        aria-current="page">{{ record.get_full_name }}
                </ol>
            </nav>
            <div>
                <button id="watch-button" class="btn rounded-pill" data-trigger="hover" data-toggle="popover"
                        data-content="{% if watch_record %}Obserwujesz ten rekord{% else %}Chcesz obserwować ten rekord?{% endif %}"
                        data-placement="bottom"
                        onclick="watchRecord('{{ record.id }}')"
                        watching-record="{% if watch_record %}following{% else %}notFollowing{% endif %}">
                    <svg id="watch_icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                         stroke-width="{% if watch_record %}2.5{% else %}1.5{% endif %}"
                         stroke="currentColor" class="w-6 h-6 {% if watch_record %}text-primary{% endif %}" width="25">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path>
                    </svg>
                </button>
                {% if perms.crm.change_location %}
                    <a href="/location/edit/{{ record.id }}" class="btn btn-primary rounded-pill font-size-12">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1"
                             stroke="currentColor" class="w-6 h-6" width="18">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                        </svg>
                        Edytuj
                    </a>
                {% endif %}
                {% if perms.crm.delete_location %}
                    <a href="/delete/{{ record.id }}" class="btn btn-outline-danger rounded-pill font-size-12">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1"
                             stroke="currentColor" class="w-6 h-6" width="18">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"></path>
                        </svg>
                        Usuń
                    </a>
                {% endif %}
            </div>
        </div>
        <div class="card-body">
            <ul class="nav nav-tabs" id="myTab-1" role="tablist">
                <li class="nav-item">
                    <a class="nav-link {% if request.GET.tab == 'Details' %}active{% endif %}" id="home-tab"
                       data-toggle="tab" href="#details" role="tab"
                       aria-controls="details" aria-selected="true"
                       onclick="addParamToURL('tab', 'Details')">Szczegóły</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.GET.tab == 'Notes' %}active{% endif %}" id="lessons-tab"
                       data-toggle="tab" href="#notes" role="tab"
                       aria-controls="lessons" aria-selected="false"
                       onclick="addParamToURL('tab', 'Notes')">Notatki</a>
                </li>
            </ul>
            <div class="tab-content" id="tab-student">
                <div class="tab-pane fade {% if request.GET.tab == 'Details' %}show active{% endif %}" id="details"
                     role="tabpanel" aria-labelledby="details-tab">

                    <form>
                        {% csrf_token %}
                        <div class=" row align-items-center">
                            <div class="form-group col-sm-6">
                                <label for="location_name">Nazwa:</label>
                                <p class="pb-1 field">{{ record.name|default:"-" }}</p>
                            </div>
                            <div class="form-group col-sm-6">
                                <label for="location_country">Kraj:</label>
                                <p class="pb-1 field">{{ record.country|default:"-" }}</p>
                            </div>
                            <div class="form-group col-sm-6">
                                <label for="location_city">Miasto:</label>
                                <p class="pb-1 field">{{ record.city|default:"-" }}</p>
                            </div>
                            <div class="form-group col-sm-6">
                                <label for="location_street">Ulica:</label>
                                <p class="pb-1 field">{{ record.street|default:"-" }}</p>
                            </div>
                            <div class="form-group col-sm-6">
                                <label for="location_postal_code">Kod pocztowy:</label>
                                <p class="pb-1 field">{{ record.postal_code|default:"-" }}</p>
                            </div>
                        </div>
                    </form>
                </div>

                {% include 'modules/notes.html' %} {# tab with notes and modal for adding notes #}

                {#                <div class="tab-pane fade {% if request.GET.tab == 'Notes' %}show active{% endif %}" id="notes"#}
                {#                     role="tabpanel" aria-labelledby="details-tab">#}
                {#                    <div class="my-4">#}
                {#                        <a href="" class="btn btn-primary rounded-pill font-size-12"#}
                {#                           type="button" data-toggle="modal"#}
                {#                           data-target="#addNoteModalCenter">#}
                {#                            + Dodaj Notatkę#}
                {#                        </a>#}
                {##}
                {#                    </div>#}
                {#                    <div id="note-full-container" class="row">#}
                {#                        {% for note in notes %}#}
                {#                            <div class="col-lg-4 col-md-6" style="">#}
                {#                                <div class="card card-body">#}
                {#                                    <p class="font-12 text-muted">{{ note.created_at }} {{ note.created_by.get_full_name }}</p>#}
                {#                                    <div class="">#}
                {#                                        <p class="">#}
                {#                                            {{ note.content }}#}
                {#                                        </p>#}
                {#                                    </div>#}
                {#                                    <div class="d-flex align-items-center">#}
                {#                                        <div class="ml-auto">#}
                {#                                            <div class="btn-group">#}
                {#                                                <a class="nav-link dropdown-toggle label-group p-0"#}
                {#                                                   data-toggle="dropdown" href="#" role="button" aria-haspopup="true"#}
                {#                                                   aria-expanded="true">#}
                {#                                                </a>#}
                {#                                                <div class="dropdown-menu dropdown-menu-right">#}
                {#                                                    <a class="badge-group-item dropdown-item position-relative text-info"#}
                {#                                                       href="#">#}
                {#                                                        Edytuj#}
                {#                                                    </a>#}
                {#                                                    <a class="badge-group-item dropdown-item position-relative text-danger"#}
                {#                                                       href="#;">#}
                {#                                                        Usuń#}
                {#                                                    </a>#}
                {#                                                </div>#}
                {#                                            </div>#}
                {#                                        </div>#}
                {#                                    </div>#}
                {#                                </div>#}
                {#                            </div>#}
                {#                        {% endfor %}#}
                {#                    </div>#}
                {##}
                {#                </div>#}
            </div>
        </div>
    </div>
    {#    <div class="modal fade" id="addNoteModalCenter" tabindex="-1" role="dialog"#}
    {#         aria-labelledby="cancelModalCenterTitle" aria-hidden="true">#}
    {#        <div class="modal-dialog modal-dialog-centered" role="document">#}
    {#            <div class="modal-content">#}
    {#                <div class="modal-header">#}
    {#                    <h5 class="modal-title" id="noteModalCenterTitle">Dodawanie Notatki</h5>#}
    {#                    <button id="addNoteModal_closeWindow" type="button" class="close" data-dismiss="modal"#}
    {#                            aria-label="Close">#}
    {#                        <span aria-hidden="true">&times;</span>#}
    {#                    </button>#}
    {#                </div>#}
    {#                <form method="post" name="add_note_form" id="add_note_from">#}
    {#                    {% csrf_token %}#}
    {#                    <div class="modal-body">#}
    {#                        {% csrf_token %}#}
    {#                        <div class=" row align-items-center">#}
    {#                            <div class="form-group col-sm-12">#}
    {#                                <label for="content_addNoteForm">Treść</label>#}
    {#                                <p class="text-danger" id="addNoteModal_textAreaError"></p>#}
    {#                                <textarea class="form-control" name="content" id="content_addNoteForm"#}
    {#                                          style="line-height: 1"#}
    {#                                          rows="4" required maxlength="200"></textarea>#}
    {#                            </div>#}
    {#                            <div class="form-group col-sm-6">#}
    {#                                <label for="location_addNoteForm">Lokalizacja</label>#}
    {#                                <input class="form-control" id="location_addNoteForm" required readonly=""#}
    {#                                       value="{{ record.get_full_name }}">#}
    {#                            </div>#}
    {#                            <div class="form-group col-sm-6" hidden="">#}
    {#                                <label for="recordId_addNoteForm">Rekord Id</label>#}
    {#                                <input class="form-control" id="recordId_addNoteForm" required readonly=""#}
    {#                                       value="{{ record.id }}">#}
    {#                            </div>#}
    {#                            <div class="form-group col-sm-6" hidden="">#}
    {#                                <label for="modelName_addNoteForm">Model Name</label>#}
    {#                                <input class="form-control" id="modelName_addNoteForm" required readonly=""#}
    {#                                       value="{{ location|verbose_name }}">#}
    {#                            </div>#}
    {#                        </div>#}
    {##}
    {#                    </div>#}
    {#                    <div class="modal-footer">#}
    {#                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Anuluj</button>#}
    {#                        <button name="addnote_form_btn" id="addnote_form_btn" type="button"#}
    {#                                class="btn btn-primary" onclick="createNote()">Zapisz Notatkę#}
    {#                        </button>#}
    {#                    </div>#}
    {#                </form>#}
    {#            </div>#}
    {#        </div>#}
    {#    </div>#}
{% endblock content %}

{% block javascript %}
    {#    <script src="{% static '/js/notes.js' %}"></script>#}
    <script src="{% static '/js/watchRecord.js' %}"></script>
    <script>
        function addParamToURL(key, value) {
            const currentURL = window.location.href;
            const searchParams = new URLSearchParams(window.location.search);
            // Dodaj parametr tab_name
            searchParams.set(key, value);

            // Utw\u00F3rz nowy URL z dodanym parametrem
            const newURL = currentURL.split('?')[0] + '?' + searchParams.toString();

            // Zast\u0105p obecny URL nowym URL z dodanym parametrem
            window.history.replaceState({path: newURL}, '', newURL);
        }
    </script>
{% endblock javascript %}