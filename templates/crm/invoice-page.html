{% extends 'base/base.html' %}
{% load static %}
{% block title %}{{ person.get_full_name }}{% endblock title %}
{% block style %}
    <style>
    </style>
{% endblock style %}
{% block content %}
    {% load crm_tags %}

    <div class="card">
        <div class="card-header d-flex justify-content-between">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/student">
                        <i class="ri-home-4-line mr-1 float-left"></i>Uczniowie</a>
                    </li>
                    <li class="breadcrumb-item"><a href="/student/{{ record.student.id }}?tab=Invoices">
                        <i class="ri-home-4-line mr-1 float-left"></i>{{ record.student }}</a>
                    </li>
                    <li class="breadcrumb-item active"
                        aria-current="page">{{ record }}
                    </li>
                </ol>
            </nav>
            <div>
                {% if perms.crm.change_invoice %}
                    <a href="/invoice/edit/{{ record.id }}" class="btn btn-primary rounded-pill font-size-12">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1"
                             stroke="currentColor" class="w-6 h-6" width="18">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                        </svg>
                        Edytuj
                    </a>
                {% endif %}
                {% if perms.crm.delete_invoice %}
                    <a href="/delete/{{ record.id }}" class="btn btn-outline-danger rounded-pill font-size-12">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1"
                             stroke="currentColor" class="w-6 h-6" width="18">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"></path>
                        </svg>
                        Usuń
                    </a>
                {% endif %}
            </div>
        </div>
        <div class="card-body">
            <ul class="nav nav-tabs" id="myTab-1" role="tablist">
                <li class="nav-item">
                    <a class="nav-link {% if request.GET.tab == 'Details' %}active{% endif %}" id="home-tab"
                       data-toggle="tab" href="#details" role="tab"
                       aria-controls="details" aria-selected="true"
                       onclick="addParamToURL('tab', 'Details')">Szczegóły</a>
                </li>
            </ul>
            <div class="tab-content" id="tab-student">
                <div class="tab-pane fade {% if request.GET.tab == 'Details' %}show active{% endif %}" id="details"
                     role="tabpanel" aria-labelledby="details-tab">


                    <div class=" row align-items-center">
                        <div class="form-group col-sm-6">
                            <label for="student_first_name">Nr faktury:</label>
                            <p class="pb-1 field">{{ record.name|default:"-" }}</p>
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="student_last_name">Data faktury:</label>
                            <p class="pb-1 field">{{ record.invoice_date|default:"-"|date:"F Y" }}</p>
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="student_last_name">Czy wysłana:</label>
                            <p class="pb-1 field">{{ record.is_sent|yes_no }}</p>
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="student_last_name">Czy zapłacona:</label>
                            <p class="pb-1 field">{{ record.is_paid|yes_no }}</p>
                        </div>
                        <div class="form-group col-sm-6">
                            <label for="student_last_name">Suma faktury:</label>
                            <p class="pb-1 field">{{ record.get_total_amount|default:"-" }} zł</p>
                        </div>

                    </div>

                    <div class="card mb-4 shadow-sm">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Pozycje na fakturze</h5>
                            {% if perms.crm.add_student_person %}
                                <a href="/Invoiceitem/new?invoice={{ record.id }}&discard_url=/invoice/{{ record.id }}"
                                   class="btn btn-sm btn-primary rounded-pill align-content-center d-inline-flex">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                         stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-1" width="18">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"></path>
                                    </svg>
                                    Dodaj pozycję
                                </a>
                            {% endif %}
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover table-striped table-bordered mb-0">
                                    <thead class="table-light text-center">
                                    <tr>
                                        <th>Nazwa</th>
                                        <th>Kwota</th>
                                        <th>Ilość</th>
                                        <th>Akcje</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% if record.invoiceitem_set.all %}
                                        {% for invoice_item in record.invoiceitem_set.all %}
                                            <tr>
                                                <td class="text-center">{{ invoice_item.name }}</td>
                                                <td class="text-center">{{ invoice_item.amount }} zł</td>
                                                <td class="text-center">{{ invoice_item.quantity }}</td>
                                                <td class="text-center">
                                                    <a href="/invoiceItem/edit/{{ invoice_item.id }}"
                                                       class="text-primary me-2" data-bs-toggle="tooltip"
                                                       title="Edytuj pozycję">
                                                        <!-- Heroicon edit -->
                                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                                             viewBox="0 0 24 24"
                                                             stroke-width="1" stroke="currentColor" class="w-6 h-6"
                                                             width="18">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                  d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5
                                                  21.036H3v-3.572L16.732 3.732z"></path>
                                                        </svg>
                                                    </a>
                                                    <a href="/delete/{{ invoice_item.id }}" class="text-danger"
                                                       data-bs-toggle="tooltip" title="Usuń pozycję">
                                                        <!-- Heroicon trash -->
                                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                                             viewBox="0 0 24 24"
                                                             stroke-width="1.5" stroke="currentColor" class="w-6 h-6"
                                                             width="18">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                  d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107
                                                  1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0
                                                  1-2.244 2.077H8.084a2.25 2.25 0 0
                                                  1-2.244-2.077L4.772 5.79m14.456
                                                  0a48.108 48.108 0 0 0-3.478-.397m-12
                                                  .562c.34-.059.68-.114 1.022-.165m0
                                                  0a48.11 48.11 0 0 1 3.478-.397m7.5
                                                  0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964
                                                  51.964 0 0 0-3.32 0c-1.18.037-2.09
                                                  1.022-2.09 2.201v.916m7.5 0a48.667
                                                  48.667 0 0 0-7.5 0"></path>
                                                        </svg>
                                                    </a>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="5" class="text-center">Brak powiązanych pozycji</td>
                                        </tr>
                                    {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock content %}

{% block javascript %}
    <script>
        const attendance_list_id = "{{ record.id }}";
    </script>
    <script src="{% static '/js/attendance_list.js' %}"></script>
{% endblock javascript %}